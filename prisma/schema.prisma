generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum VideoStatus {
  UPLOADED
  QUEUED
  PROCESSING
  READY
  FAILED
}

enum AssetType {
  ORIGINAL
  TRANSCODED
  PREVIEW_CLIP
  POSTER
  FRAME
}

enum Format {
  MP4
  WEBM
  AV1
}

model Video {
  id           String      @id @default(cuid())
  title        String
  originalName String
  mimeType     String
  byteSize     Int
  durationSec  Int?
  width        Int?
  height       Int?
  status       VideoStatus @default(UPLOADED)
  errorMessage String?
  errorCode    String?
  lastFailedAt DateTime?
  retryCount   Int         @default(0)
  maxRetries   Int         @default(3)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  assets       Asset[]
}

model Asset {
  id           String     @id @default(cuid())
  videoId      String
  video        Video      @relation(fields: [videoId], references: [id], onDelete: Cascade)
  type         AssetType
  format       Format?
  path         String
  data         Bytes?     @db.LongBlob
  byteSize     Int?
  width        Int?
  height       Int?
  durationSec  Int?
  timeOffsetMs Int?
  isDefault    Boolean    @default(false)
  createdAt    DateTime   @default(now())
  tokens       DownloadToken[]
}

model DownloadToken {
  id        String   @id @default(cuid())
  assetId   String
  asset     Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)
  tokenHash String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([assetId])
  @@index([expiresAt])
}



